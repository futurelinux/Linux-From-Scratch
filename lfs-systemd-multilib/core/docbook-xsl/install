# package install script

action=$1
newversion=$2
oldversion=$3

post_install() {
	version=$1
	if [ ! -d /etc/xml ]; then install -v -m755 -d /etc/xml; fi
	if [ ! -f /etc/xml/catalog ]; then
		xmlcatalog --noout --create /etc/xml/catalog
	fi

	xmlcatalog --noout --add "rewriteSystem" \
				"https://cdn.docbook.org/release/xsl-nons/$version" \
				 "/usr/share/xml/docbook/xsl-stylesheets-nons-$version" \
		/etc/xml/catalog 

	xmlcatalog --noout --add "rewriteURI" \
				"https://cdn.docbook.org/release/xsl-nons/$version" \
				"/usr/share/xml/docbook/xsl-stylesheets-nons-$version" \
		/etc/xml/catalog

	xmlcatalog --noout --add "rewriteSystem" \
				"https://cdn.docbook.org/release/xsl-nons/current" \
				"/usr/share/xml/docbook/xsl-stylesheets-nons-$version" \
		/etc/xml/catalog

	xmlcatalog --noout --add "rewriteURI" \
				"https://cdn.docbook.org/release/xsl-nons/current" \
				"/usr/share/xml/docbook/xsl-stylesheets-nons-$version" \
		/etc/xml/catalog
	
	xmlcatalog --noout --add "rewriteSystem" \
				"http://docbook.sourceforge.net/release/xsl/current" \
				"/usr/share/xml/docbook/xsl-stylesheets-nons-$version" \
		/etc/xml/catalog

	xmlcatalog --noout --add "rewriteURI" \
				"http://docbook.sourceforge.net/release/xsl/current" \
				"/usr/share/xml/docbook/xsl-stylesheets-nons-$version" \
		/etc/xml/catalog

	unset version
}

case $action in
	post-install)
		post_install $newversion
		;;
	post-upgrade)
		post_remove $oldversion
		post_install $newversion
		;;
	post-remove)
		post_remove $newversion
		;;
esac
