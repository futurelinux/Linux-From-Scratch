#!/bin/bash -e


TMP=${TMP:-$(mktemp -d)}
LOG=${LOG:-$(dirname $0)/log}
SRC=${SRC:-/home/sources/lfs}

pkgbase=Perl-5.32.0
pkgname=perl
pkgver=5.32.0

rm -fr $TMP
mkdir -p $TMP $LOG $SRC $(dirname $0)/build

tar xf $SRC/$pkgname-$pkgver.tar.xz -C $TMP

{ time \
   {

    cd $TMP/$pkgname-$pkgver

    export BUILD_ZLIB=False
    export BUILD_BZIP2=0

  sh Configure -des                                       \
    -Dprefix=/usr                                         \
    -Dvendorprefix=/usr                                   \
    -Dprivlib=/usr/share/perl5/core_perl                  \
    -Darchlib=/usr/lib/perl5/${pkgver:0:4}/core_perl      \
    -Dsitelib=/usr/share/perl5/site_perl                  \
    -Dsitearch=/usr/lib/perl5/${pkgver:0:4}/site_perl     \
    -Dvendorlib=/usr/share/perl5/vendor_perl              \
    -Dvendorarch=/usr/lib/perl5/${pkgver:0:4}/vendor_perl \
    -Dman1dir=/usr/share/man/man1                         \
    -Dman3dir=/usr/share/man/man3                         \
    -Dpager="/usr/bin/less -isR"                          \
    -Duseshrplib                                          \
    -Dusethreads

    make

    make install
    unset BUILD_ZLIB BUILD_BZIP2
    
    }
} 2>&1 | tee $LOG/$pkgbase.log
    
[ $PIPESTATUS = 0 ] && echo "$pkgname-$pkgver" > $(dirname $0)/build/$pkgbase || exit $PIPESTATUS

rm -fr $TMP
