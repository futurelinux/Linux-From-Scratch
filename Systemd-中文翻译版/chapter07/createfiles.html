<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.6.&nbsp;创建必要的文件和符号链接
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-20200927-systemd，中文翻译版">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 20200927-systemd，中文翻译版
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title="创建目录">上一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="gcc-libstdc++-pass2.html" title=
          "GCC-10.2.0 中的 Libstdc++，第二遍">下一页</a>
          <p>
            GCC-10.2.0 中的 Libstdc++，第二遍
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200927-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-tools-createfiles" name="ch-tools-createfiles"></a>7.6.
        创建必要的文件和符号链接
      </h1>
      <p>
        历史上，Linux 在 <code class="filename">/etc/mtab</code>
        维护已经挂载的文件系统的列表。现代内核在内部维护该列表，并通过 <code class="filename">/proc</code>
        文件系统将它展示给用户。为了满足那些需要 <code class="filename">/etc/mtab</code>
        的工具，执行以下命令，创建符号链接：
      </p>
      <pre class="userinput"><kbd class=
      "command">ln -sv /proc/self/mounts /etc/mtab</kbd></pre>
      <p>
        创建一个基本的 <code class="filename">/etc/hosts</code> 文件，一些测试套件，以及 Perl
        的一个配置文件将会使用它：
      </p>
      <pre class="userinput"><kbd class=
      "command">echo "127.0.0.1 localhost $(hostname)" &gt; /etc/hosts</kbd></pre>
      <p>
        为了使得 <code class="systemitem">root</code> 能正常登录，而且用户名 <span class=
        "quote">“<span class="quote">root</span>”</span> 能被正常识别，必须在文件
        <code class="filename">/etc/passwd</code> 和 <code class=
        "filename">/etc/groups</code> 中写入相关的条目。
      </p>
      <p>
        执行以下命令创建 <code class="filename">/etc/passwd</code> 文件：
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/passwd &lt;&lt; "EOF"
<code class="literal">root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/dev/null:/bin/false
daemon:x:6:6:Daemon User:/dev/null:/bin/false
messagebus:x:18:18:D-Bus Message Daemon User:/var/run/dbus:/bin/false
systemd-bus-proxy:x:72:72:systemd Bus Proxy:/:/bin/false
systemd-journal-gateway:x:73:73:systemd Journal Gateway:/:/bin/false
systemd-journal-remote:x:74:74:systemd Journal Remote:/:/bin/false
systemd-journal-upload:x:75:75:systemd Journal Upload:/:/bin/false
systemd-network:x:76:76:systemd Network Management:/:/bin/false
systemd-resolve:x:77:77:systemd Resolver:/:/bin/false
systemd-timesync:x:78:78:systemd Time Synchronization:/:/bin/false
systemd-coredump:x:79:79:systemd Core Dumper:/:/bin/false
nobody:x:99:99:Unprivileged User:/dev/null:/bin/false</code>
EOF</kbd></pre>
      <p>
        我们以后再设置 <code class="systemitem">root</code> 用户的实际密码。
      </p>
      <p>
        执行以下命令，创建 <code class="filename">/etc/group</code> 文件：
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/group &lt;&lt; "EOF"
<code class="literal">root:x:0:
bin:x:1:daemon
sys:x:2:
kmem:x:3:
tape:x:4:
tty:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
lp:x:9:
dialout:x:10:
audio:x:11:
video:x:12:
utmp:x:13:
usb:x:14:
cdrom:x:15:
adm:x:16:
messagebus:x:18:
systemd-journal:x:23:
input:x:24:
mail:x:34:
kvm:x:61:
systemd-bus-proxy:x:72:
systemd-journal-gateway:x:73:
systemd-journal-remote:x:74:
systemd-journal-upload:x:75:
systemd-network:x:76:
systemd-resolve:x:77:
systemd-timesync:x:78:
systemd-coredump:x:79:
wheel:x:97:
nogroup:x:99:
users:x:999:</code>
EOF</kbd></pre>
      <p>
        这里创建的用户组并不属于任何标准 —— 它们一部分是为了满足第 9 章中 Udev 配置的需要，另一部分借鉴了一些 Linux
        发行版的通用惯例。另外，某些测试套件需要特定的用户或组。Linux Standard Base (LSB，可以在 <a class=
        "ulink" href=
        "http://refspecs.linuxfoundation.org/lsb.shtml">http://refspecs.linuxfoundation.org/lsb.shtml</a>
        查看) 标准只推荐以组 ID 0 创建用户组 <code class="systemitem">root</code>，以及以组 ID 1
        创建用户组 <code class="systemitem">bin</code>，其他组名和组 ID
        由系统管理员自由分配，因为好的程序不会依赖组 ID 数字，而是使用组名。
      </p>
      <p>
        <a class="xref" href="../chapter08/chapter08.html" title=
        "第&nbsp;8&nbsp;章&nbsp;安装基本系统软件">第 8
        章</a>中的一些测试需要使用一个普通用户。我们这里创建一个用户，在那一章的末尾再删除该用户。
      </p>
      <pre class="userinput"><kbd class=
      "command">echo "tester:x:$(ls -n $(tty) | cut -d" " -f3):101::/home/tester:/bin/bash" &gt;&gt; /etc/passwd
echo "tester:x:101:" &gt;&gt; /etc/group
install -o tester -d /home/tester</kbd></pre>
      <p>
        为了移除 <span class="quote">“<span class="quote">I have no
        name!</span>”</span> 提示符，需要打开一个新 shell。由于已经创建了文件 <code class=
        "filename">/etc/passwd</code> 和 <code class=
        "filename">/etc/group</code>，用户名和组名现在就可以正常解析了：
      </p>
      <pre class="userinput"><kbd class=
      "command">exec /bin/bash --login +h</kbd></pre>
      <p>
        注意这里使用了 <em class="parameter"><code>+h</code></em> 参数。它告诉
        <span class="command"><strong>bash</strong></span>
        不要使用内部的路径散列机制。如果没有指定该参数，<span class=
        "command"><strong>bash</strong></span>
        会记忆它执行过程序的路径。为了在安装新编译好的程序后马上使用它们，在本章和下一章中总是使用 <em class=
        "parameter"><code>+h</code></em>。
      </p>
      <p>
        <span class="command"><strong>login</strong></span>、<span class=
        "command"><strong>agetty</strong></span> 和 <span class=
        "command"><strong>init</strong></span>
        等程序使用一些日志文件，以记录登录系统的用户和登录时间等信息。然而，这些程序不会创建不存在的日志文件。初始化日志文件，并为它们设置合适的访问权限：
      </p>
      <pre class="userinput"><kbd class=
      "command">touch /var/log/{btmp,lastlog,faillog,wtmp}
chgrp -v utmp /var/log/lastlog
chmod -v 664  /var/log/lastlog
chmod -v 600  /var/log/btmp</kbd></pre>
      <p>
        文件 <code class="filename">/var/log/wtmp</code> 记录所有的登录和登出，文件
        <code class="filename">/var/log/lastlog</code> 记录每个用户最后登录的时间，文件
        <code class="filename">/var/log/faillog</code> 记录所有失败的登录尝试，文件
        <code class="filename">/var/log/btmp</code> 记录所有错误的登录尝试。
      </p>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          文件 <code class="filename">/run/utmp</code> 记录当前登录的用户，它由引导脚本动态创建。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title="创建目录">上一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="gcc-libstdc++-pass2.html" title=
          "GCC-10.2.0 中的 Libstdc++，第二遍">下一页</a>
          <p>
            GCC-10.2.0 中的 Libstdc++，第二遍
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200927-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
