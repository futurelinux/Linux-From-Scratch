<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      5.3.&nbsp;GCC-10.2.0 - 第一遍
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-20200927-systemd，中文翻译版">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 20200927-systemd，中文翻译版
      </h4>
      <h3>
        第&nbsp;5&nbsp;章&nbsp;编译交叉工具链
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="binutils-pass1.html" title=
          "Binutils-2.35 - 第一遍">上一页</a>
          <p>
            Binutils-2.35 - 第一遍
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-5.8.9 API 头文件">下一页</a>
          <p>
            Linux-5.8.9 API 头文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "第&nbsp;5&nbsp;章&nbsp;编译交叉工具链">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200927-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
    <div class="wrap" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-tools-gcc-pass1" name="ch-tools-gcc-pass1"></a>5.3.
        GCC-10.2.0 - 第一遍
      </h1>
      <div class="package" lang="zh-cn" xml:lang="zh-cn">
        <p>
          GCC 软件包包含 GNU 编译器集合，其中有 C 和 C++ 编译器。
        </p>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">估计构建时间:</strong> <span class=
              "segbody">11 SBU</span>
            </div>
            <div class="seg">
              <strong class="segtitle">需要硬盘空间:</strong> <span class=
              "segbody">3.8 GB</span>
            </div>
          </div>
        </div>
      </div>
      <div class="installation" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          5.3.1. 安装交叉工具链中的 GCC
        </h2>
        <p>
          GCC 依赖于 GMP、MPFR 和 MPC 这三个包。由于宿主发行版未必包含它们，我们将它们和 GCC 一同构建。将它们都解压到
          GCC 源码目录中，并重命名解压出的目录，这样 GCC 构建过程就能自动使用它们：
        </p>
        <div class="admon note">
          <img alt="[注意]" src="../images/note.png" />
          <h3>
            注意
          </h3>
          <p>
            对于本章内容有一些很常见的误解。该软件包的构建过程就像之前 (<a class="xref" href=
            "../partintro/generalinstructions.html#buildinstr">软件包构建说明</a>)
            解释的那样，首先解压 GCC 压缩包，切换到解压出的目录中，再执行下面的命令。
          </p>
        </div>
        <pre class="userinput"><kbd class=
        "command">tar -xf ../mpfr-4.1.0.tar.xz
mv -v mpfr-4.1.0 mpfr
tar -xf ../gmp-6.2.0.tar.xz
mv -v gmp-6.2.0 gmp
tar -xf ../mpc-1.2.0.tar.gz
mv -v mpc-1.2.0 mpc</kbd></pre>
        <p>
          对于 x86_64 平台，还要设置存放 64 位库的默认目录为 <span class="quote">“<span class=
          "quote">lib</span>”</span>：
        </p>
        <pre class="userinput"><kbd class="command">case $(uname -m) in
  x86_64)
    sed -e '/m64=/s/lib64/lib/' \
        -i.orig gcc/config/i386/t-linux64
 ;;
esac</kbd></pre>
        <p>
          GCC 文档建议在一个专用目录中构建 GCC：
        </p>
        <pre class="userinput"><kbd class="command">mkdir -v build
cd       build</kbd></pre>
        <p>
          准备编译 GCC：
        </p>
        <pre class="userinput"><kbd class=
        "command">../configure                                       \
    --target=$LFS_TGT                              \
    --prefix=$LFS/tools                            \
    --with-glibc-version=2.11                      \
    --with-sysroot=$LFS                            \
    --with-newlib                                  \
    --without-headers                              \
    --enable-initfini-array                        \
    --disable-nls                                  \
    --disable-shared                               \
    --disable-multilib                             \
    --disable-decimal-float                        \
    --disable-threads                              \
    --disable-libatomic                            \
    --disable-libgomp                              \
    --disable-libquadmath                          \
    --disable-libssp                               \
    --disable-libvtv                               \
    --disable-libstdcxx                            \
    --enable-languages=c,c++</kbd></pre>
        <div class="variablelist">
          <p class="title">
            <strong>配置选项的含义：</strong>
          </p>
          <dl class="variablelist">
            <dt>
              <span class="term"><em class=
              "parameter"><code>--with-glibc-version=2.11</code></em></span>
            </dt>
            <dd>
              <p>
                该选项确保该软件包与宿主的 glibc 版本兼容。它被设定为<a class="xref" href=
                "../chapter02/hostreqs.html" title=
                "2.2.&nbsp;宿主系统需求">宿主系统需求</a>中要求的最小 glibc 版本一致。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--with-newlib</code></em></span>
            </dt>
            <dd>
              <p>
                由于现在没有可用的 C 运行库，使用该选项保证构建 libgcc 时 inhibit_libc
                常量被定义，以防止编译任何需要 libc 支持的代码。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--without-headers</code></em></span>
            </dt>
            <dd>
              <p>
                在创建完整的交叉编译器时，GCC 需要与目标系统兼容的标准头文件。由于我们的特殊目的，这些头文件并不必要。这个开关防止
                GCC 查找它们。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-initfini-array</code></em></span>
            </dt>
            <dd>
              <p>
                这个开关强制启用一些内部数据结构，它们是必要的，但是在构建交叉编译器时，无法被检测到。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-shared</code></em></span>
            </dt>
            <dd>
              <p>
                这个开关强制 GCC 静态链接它的内部库。我们必须这样做，因为动态库需要目标系统中尚未安装的 glibc。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-multilib</code></em></span>
            </dt>
            <dd>
              <p>
                在 x86_64 平台上，LFS 不支持 multilib 配置。这个开关对于 x86 来说可有可无。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-decimal-float, --disable-threads,
              --disable-libatomic, --disable-libgomp, --disable-libquadmath,
              --disable-libssp, --disable-libvtv,
              --disable-libstdcxx</code></em></span>
            </dt>
            <dd>
              <p>
                这些开关禁用对于十进制浮点数、线程、libatomic、libgomp、libquadmath、libssp、libvtv
                和 C++ 标准库的支持。在构建交叉编译器时它们的编译会失败，而且在交叉编译临时 libc 时并不需要它们。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-languages=c,c++</code></em></span>
            </dt>
            <dd>
              <p>
                这个选项保证只构建 C 和 C++ 编译器。目前只需要这两个语言。
              </p>
            </dd>
          </dl>
        </div>
        <p>
          执行以下命令编译 GCC：
        </p>
        <pre class="userinput"><kbd class="command">make</kbd></pre>
        <p>
          安装该软件包：
        </p>
        <pre class="userinput"><kbd class="command">make install</kbd></pre>
        <p>
          刚刚构建的 GCC 安装了若干内部系统头文件。其中的 <code class="filename">limits.h</code>
          一般来说，应该包含对应的系统头文件 <code class="filename">limits.h</code>，在我们的 LFS
          环境中，就是 <code class=
          "filename">$LFS/usr/include/limits.h</code>。然而，在构建 GCC
          的时候，<code class="filename">$LFS/usr/include/limits.h</code> 还不存在，因此
          GCC 安装的内部头文件是一个不完整的、自给自足的文件，不包含系统头文件提供的扩展特性。这对于构建临时的 libc
          已经足够了，但后续工作将需要完整的内部头文件。使用以下命令创建一个完整版本的内部头文件，该命令与 GCC
          构建系统在一般情况下生成该头文件的命令是一致的：
        </p>
        <pre class="userinput"><kbd class="command">cd ..
cat gcc/limitx.h gcc/glimits.h gcc/limity.h &gt; \
  `dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/install-tools/include/limits.h</kbd></pre>
      </div>
      <div class="content" lang="zh-cn" xml:lang="zh-cn">
        <p>
          该软件包的更多细节在<a class="xref" href="../chapter08/gcc.html#contents-gcc"
          title="8.26.2.&nbsp;GCC 的内容">第&nbsp;8.26.2&nbsp;节 “GCC
          的内容”</a>可以找到。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="binutils-pass1.html" title=
          "Binutils-2.35 - 第一遍">上一页</a>
          <p>
            Binutils-2.35 - 第一遍
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-5.8.9 API 头文件">下一页</a>
          <p>
            Linux-5.8.9 API 头文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "第&nbsp;5&nbsp;章&nbsp;编译交叉工具链">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200927-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
