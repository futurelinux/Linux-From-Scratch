<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      9.7.&nbsp;配置系统 Locale
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-20200927-systemd，中文翻译版">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 20200927-systemd，中文翻译版
      </h4>
      <h3>
        第&nbsp;9&nbsp;章&nbsp;系统配置
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="console.html" title="配置 Linux 控制台">上一页</a>
          <p>
            配置 Linux 控制台
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="inputrc.html" title=
          "创建 /etc/inputrc 文件">下一页</a>
          <p>
            创建 /etc/inputrc 文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter09.html" title=
          "第&nbsp;9&nbsp;章&nbsp;系统配置">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200927-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-config-locale" name="ch-config-locale"></a>9.7. 配置系统 Locale
      </h1>
      <p>
        下面将创建的 <code class="filename">/etc/locale.conf</code>
        设定本地语言支持需要的若干环境变量，正确设定它们可以带来以下好处：
      </p>
      <div class="itemizedlist">
        <ul>
          <li class="listitem">
            <p>
              程序输出被翻译成本地语言
            </p>
          </li>
          <li class="listitem">
            <p>
              字符被正确分类为字母、数字和其他类别，这对于使 <span class=
              "command"><strong>bash</strong></span> 正确接受命令行中的非 ASCII
              本地非英文字符来说是必要的
            </p>
          </li>
          <li class="listitem">
            <p>
              根据所在地区惯例排序字母
            </p>
          </li>
          <li class="listitem">
            <p>
              适用于所在地区的默认纸张尺寸
            </p>
          </li>
          <li class="listitem">
            <p>
              正确格式化货币、时间和日期值
            </p>
          </li>
        </ul>
      </div>
      <p>
        将下面的 <em class="replaceable"><code>&lt;ll&gt;</code></em>
        替换为所需语言的双字符代号 (例如<span class="quote">“<span class=
        "quote">en</span>”</span>)，<em class=
        "replaceable"><code>&lt;CC&gt;</code></em> 替换为国家或地区的双字符代号
        (例如<span class="quote">“<span class=
        "quote">GB</span>”</span>)，<em class=
        "replaceable"><code>&lt;charmap&gt;</code></em> 替换为您选定的 locale
        的标准字符映射。另外，还可以加入 <span class="quote">“<span class=
        "quote">@euro</span>”</span> 等可选修饰符。
      </p>
      <p>
        Glibc 支持的所有 locale 可以用以下命令列出：
      </p>
      <pre class="userinput"><kbd class="command">locale -a</kbd></pre>
      <p>
        字符映射可能有多个别名，例如<span class="quote">“<span class=
        "quote">ISO-8859-1</span>”</span>也可以称为<span class=
        "quote">“<span class="quote">iso8859-1</span>”</span>或者<span class=
        "quote">“<span class="quote">iso88591</span>”</span>。某些程序不能正确处理一些别名
        (例如，<span class="quote">“<span class=
        "quote">UTF-8</span>”</span>必须写作<span class="quote">“<span class=
        "quote">UTF-8</span>”</span>才能识别，而不能识别<span class=
        "quote">“<span class=
        "quote">utf8</span>”</span>)，因此在多数情况下，为了保险起见，最好使用 locale
        的规范名称。为了确定规范名称，执行以下命令，将 <em class="replaceable"><code>&lt;locale
        名&gt;</code></em> 替换成 <span class="command"><strong>locale
        -a</strong></span> 对于您希望的 locale 的输出 (以<span class=
        "quote">“<span class="quote">en_GB.iso88591</span>”</span>为例)。
      </p>
      <pre class="userinput"><kbd class="command">LC_ALL=<em class=
      "replaceable"><code>&lt;locale 名&gt;</code></em> locale charmap</kbd></pre>
      <p>
        对于<span class="quote">“<span class=
        "quote">en_GB.iso88591</span>”</span>locale，以上命令输出：
      </p>
      <pre class="screen"><code class=
      "computeroutput">ISO-8859-1</code></pre>
      <p>
        这样就最终确定 locale 应设置为<span class="quote">“<span class=
        "quote">en_GB.ISO-8859-1</span>”</span>。在将以上启发方法获得的 locale 添加到 Bash
        启动文件之前，一定要进行下列测试：
      </p>
      <pre class="userinput"><kbd class=
      "command">LC_ALL=&lt;locale 名&gt; locale language
LC_ALL=&lt;locale 名&gt; locale charmap
LC_ALL=&lt;locale 名&gt; locale int_curr_symbol
LC_ALL=&lt;locale 名&gt; locale int_prefix</kbd></pre>
      <p>
        以上命令应该输出语言名称，选定 locale
        使用的字符编码，本地货币符号，以及所在国家或地区的国际电话区号。如果以上某个命令失败并输出类似下面这样的消息，意味着您的 locale
        在第 6 章中没有安装，或者不被 Glibc 的默认安装支持。
      </p>
      <pre class="screen"><code class=
      "computeroutput">locale: Cannot set LC_* to default locale: No such file or directory</code></pre>
      <p>
        如果出现了这种消息，您应该用 <span class=
        "command"><strong>localedef</strong></span> 命令安装所需的 locale，或重新选择一个不同的
        locale。后文假设 Glibc 没有输出类似错误消息。
      </p>
      <p>
        某些 LFS 以外的软件包可能缺乏对您选择的 locale 的支持，例如 X 库 (X 窗口系统的一部分)，它在您的 locale
        与它内部文件中的字符映射表名不完全匹配时，会输出以下错误消息：
      </p>
      <pre class="screen"><code class=
      "computeroutput">Warning: locale not supported by Xlib, locale set to C</code></pre>
      <p>
        某些情况下 Xlib 期望字符映射以带有规范连字符的大写形式给出，例如应该使用
        “ISO-8859-1”而不是“iso88591”。有时也可以通过去除 locale 规范中的字符映射部分找到合适的规范，可以通过运行
        <span class="command"><strong>locale charmap</strong></span>
        确认。例如，您需要将“de_DE.ISO-8859-15@euro”替换成“de_DE@euro”，以获得 Xlib 能够识别的
        locale。
      </p>
      <p>
        其他软件包在 locale 名不符合它们的期望时可能工作不正常(但未必输出错误消息)。在这种情况下，探索一下其他 Linux
        发行版是如何支持您的 locale 的，可以得到一些有用的信息。
      </p>
      <p>
        在确定了正确的 locale 设置后，创建 <code class="filename">/etc/locale.conf</code>
        文件：
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/locale.conf &lt;&lt; "EOF"
<code class="literal">LANG=<em class=
"replaceable"><code>&lt;ll&gt;_&lt;CC&gt;.&lt;charmap&gt;&lt;@modifiers&gt;</code></em></code>
EOF</kbd></pre>
      <p>
        修改 <code class="filename">/etc/locale.conf</code> 的另一种方法是使用 systemd 的
        <span class="command"><strong>localectl</strong></span> 工具。例如，要使用
        <span class="command"><strong>localectl</strong></span> 完成上面给出的
        locale 设置，运行命令：
      </p>
      <pre class="userinput"><kbd class=
      "command">localectl set-locale LANG="<em class=
      "replaceable"><code>&lt;ll&gt;_&lt;CC&gt;.&lt;charmap&gt;&lt;@modifiers&gt;</code></em>"</kbd></pre>
      <p>
        您也可以指定其他语言相关的环境变量，例如 <code class="envar">LANG</code>，<code class=
        "envar">LC_CTYPE</code>，<code class="envar">LC_NUMERIC</code>，或
        <span class="command"><strong>locale</strong></span>
        输出的其他环境变量，用空格将它们分割即可。例如，将 <code class="envar">LANG</code> 设置为
        en_US.UTF-8，<code class="envar">LC_CTYPE</code> 设置为 en_US：
      </p>
      <pre class="userinput"><kbd class=
      "command">localectl set-locale LANG="en_US.UTF-8" LC_CTYPE="en_US"</kbd></pre>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          请注意 <span class="command"><strong>localectl</strong></span> 只能在使用
          systemd 引导的系统中使用。
        </p>
      </div>
      <p>
        <span class="quote">“<span class="quote">C</span>”</span> (默认 locale)
        和<span class="quote">“<span class=
        "quote">en_US</span>”</span>(推荐美式英语用户使用的 locale) 是不同的。<span class=
        "quote">“<span class="quote">C</span>”</span> locale 使用 US-ASCII 7
        位字符集，并且将最高位为 1 的字节视为无效字符。因此，<span class=
        "command"><strong>ls</strong></span> 等命令会将它们替换为问号。另外，如果试图用 Mutt 或
        Pine 发送包含这些字符的邮件，会发出不符合 RFC 标准的消息 (发出邮件的字符集会被标为<span class=
        "quote">“<span class="quote">未知 8 位</span>”</span>)。因此，您只能在确信自己永远不会使用
        8 位字符时才能使用<span class="quote">“<span class="quote">C</span>”</span>
        locale。
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="console.html" title="配置 Linux 控制台">上一页</a>
          <p>
            配置 Linux 控制台
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="inputrc.html" title=
          "创建 /etc/inputrc 文件">下一页</a>
          <p>
            创建 /etc/inputrc 文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter09.html" title=
          "第&nbsp;9&nbsp;章&nbsp;系统配置">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200927-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
