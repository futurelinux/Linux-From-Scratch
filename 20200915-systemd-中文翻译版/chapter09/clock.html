<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      9.5.&nbsp;配置系统时钟
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-20200915-systemd，中文翻译版">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 20200915-systemd，中文翻译版
      </h4>
      <h3>
        第&nbsp;9&nbsp;章&nbsp;系统配置
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="symlinks.html" title="管理设备">上一页</a>
          <p>
            管理设备
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="console.html" title="配置 Linux 控制台">下一页</a>
          <p>
            配置 Linux 控制台
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter09.html" title=
          "第&nbsp;9&nbsp;章&nbsp;系统配置">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200915-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-config-clock" name="ch-config-clock"></a>9.5. 配置系统时钟
      </h1>
      <p>
        本节讨论如何配置 <span class=
        "command"><strong>systemd-timedated</strong></span>
        系统服务，它的作用是配置系统时钟和时区。
      </p>
      <p>
        如果您不确定您的硬件时钟是否设置为 UTC，运行 <strong class="userinput"><code>hwclock
        --localtime --show</code></strong>
        命令，它会显示硬件时钟给出的当前时间。如果这个时间和您的手表显示的一致，则说明硬件时钟被设定为本地时间。相反，如果
        <span class="command"><strong>hwclock</strong></span>
        输出的时间不是本地时间，则硬件时钟很可能被设定为 UTC 时间。根据您的时区，在 <span class=
        "command"><strong>hwclock</strong></span>
        显示的时间上加减对应的小时数，进行进一步的验证。例如，如果您现在处于莫斯科时区，即 GMT -0700，在本地时间上加 7
        小时，再进行比较。
      </p>
      <p>
        <span class="command"><strong>systemd-timedated</strong></span> 读取
        <code class="filename">/etc/adjtime</code>，并根据其内容将硬件时钟设定为 UTC 或本地时间。
      </p>
      <p>
        如果您的硬件时钟设置为本地时间，以下列内容创建 <code class="filename">/etc/adjtime</code>
        文件：
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/adjtime &lt;&lt; "EOF"
<code class="literal">0.0 0 0.0
0
LOCAL</code>
EOF</kbd></pre>
      <p>
        如果 <code class="filename">/etc/adjtime</code> 在初次引导时不存在，<span class=
        "command"><strong>systemd-timedated</strong></span> 会假设硬件时钟使用
        UTC，并据此调整该文件。
      </p>
      <p>
        您也可以使用 <span class="command"><strong>timedatectl</strong></span> 工具告诉
        <span class="command"><strong>systemd-timedated</strong></span>
        您的硬件时钟是 UTC 还是本地时间：
      </p>
      <pre class="userinput"><kbd class=
      "command">timedatectl set-local-rtc 1</kbd></pre>
      <p>
        <span class="command"><strong>timedatectl</strong></span>
        也能修改系统时间和时区。
      </p>
      <p>
        如果要修改系统时间，执行以下命令：
      </p>
      <pre class="userinput"><kbd class=
      "command">timedatectl set-time YYYY-MM-DD HH:MM:SS</kbd></pre>
      <p>
        硬件时钟也会同时被更新。
      </p>
      <p>
        要修改当前时区，执行以下命令：
      </p>
      <pre class="userinput"><kbd class=
      "command">timedatectl set-timezone TIMEZONE</kbd></pre>
      <p>
        您可以通过运行以下命令查看可用的时区列表：
      </p>
      <pre class="userinput"><kbd class=
      "command">timedatectl list-timezones</kbd></pre>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          注意 <span class="command"><strong>timedatectl</strong></span> 命令只能用于
          systemd 引导的系统。
        </p>
      </div>
      <div class="sect2" lang="zh-cn" xml:lang="zh-cn">
        <h2 class="sect2">
          9.5.1. 网络时钟同步
        </h2>
        <p>
          从版本 213 开始，systemd 附带了一个名为 <span class=
          "command"><strong>systemd-timesyncd</strong></span>
          的守护程序，可以用于将系统时间与远程 NTP 服务器同步。
        </p>
        <p>
          该守护程序没有被设计为替代现有成熟的 NTP 守护程序，而是一个仅仅实现了 SNTP
          协议的客户端，可以用于一些不太复杂的任务，或是资源紧张的系统。
        </p>
        <p>
          从 systemd 版本 216 开始，<span class=
          "command"><strong>systemd-timesyncd</strong></span>
          守护进程被默认启用。如果希望禁用它，执行以下命令：
        </p>
        <pre class="userinput"><kbd class=
        "command">systemctl disable systemd-timesyncd</kbd></pre>
        <p>
          可以在 <code class="filename">/etc/systemd/timesyncd.conf</code> 中修改
          <span class="command"><strong>systemd-timesyncd</strong></span>
          使用的服务器。
        </p>
        <p>
          注意，当系统时钟设定为本地时间时，<span class=
          "command"><strong>systemd-timesyncd</strong></span> 不会更新硬件时钟。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="symlinks.html" title="管理设备">上一页</a>
          <p>
            管理设备
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="console.html" title="配置 Linux 控制台">下一页</a>
          <p>
            配置 Linux 控制台
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter09.html" title=
          "第&nbsp;9&nbsp;章&nbsp;系统配置">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200915-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
