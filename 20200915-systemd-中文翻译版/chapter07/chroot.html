<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.4.&nbsp;进入 Chroot 环境
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-20200915-systemd，中文翻译版">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 20200915-systemd，中文翻译版
      </h4>
      <h3>
        第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="kernfs.html" title="准备虚拟内核文件系统">上一页</a>
          <p>
            准备虚拟内核文件系统
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="creatingdirs.html" title="创建目录">下一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200915-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-tools-chroot" name="ch-tools-chroot"></a>7.4. 进入 Chroot 环境
      </h1>
      <p>
        现在已经准备好了所有继续构建其余工具时必要的软件包，可以进入 chroot
        环境并完成剩余临时工具的安装。在安装最终的系统时，会继续使用这个 chroot 环境。以 <code class=
        "systemitem">root</code> 用户身份，运行以下命令以进入当前只包含临时工具的 chroot 环境：
      </p>
      <pre class="userinput"><kbd class=
      "command">chroot "$LFS" /usr/bin/env -i   \
    HOME=/root                  \
    TERM="$TERM"                \
    PS1='(lfs chroot) \u:\w\$ ' \
    PATH=/bin:/usr/bin:/sbin:/usr/sbin \
    /bin/bash --login +h</kbd></pre>
      <p>
        通过传递 <em class="parameter"><code>-i</code></em> 选项给 <span class=
        "command"><strong>env</strong></span> 命令，可以清除 chroot
        环境中的所有环境变量。随后，只重新设定 <code class="envar">HOME</code>，<code class=
        "envar">TERM</code>，<code class="envar">PS1</code>，以及 <code class=
        "envar">PATH</code> 变量。参数 <em class=
        "parameter"><code>TERM=$TERM</code></em> 将 chroot 环境中的 <code class=
        "envar">TERM</code> 变量设为和 chroot 环境外相同的值。一些程序需要这个变量才能正常工作，例如
        <span class="command"><strong>vim</strong></span> 和 <span class=
        "command"><strong>less</strong></span>。如果需要设定其他变量，例如 <code class=
        "envar">CFLAGS</code> 或 <code class="envar">CXXFLAGS</code>，也可以在这里设定。
      </p>
      <p>
        从现在开始，就不再需要使用 <code class="envar">LFS</code> 环境变量，因为所有工作都被局限在 LFS
        文件系统内。这是由于 Bash 被告知 <code class="filename">$LFS</code> 现在是根目录
        (<code class="filename">/</code>)。
      </p>
      <p>
        注意 <code class="filename">/tools/bin</code> 不在 <code class=
        "envar">PATH</code> 中。这意味着交叉工具链在 chroot 环境中不被再使用。这还需要保证 shell
        不<span class="quote">“<span class="quote">记忆</span>”</span>执行过的程序的位置
        —— 因此需要传递 <em class="parameter"><code>+h</code></em> 参数给 <span class=
        "command"><strong>bash</strong></span> 以关闭散列功能。
      </p>
      <p>
        注意 <span class="command"><strong>bash</strong></span> 的提示符会包含
        <code class="computeroutput">I have no name!</code>。这是正常的，因为现在还没有创建
        <code class="filename">/etc/passwd</code> 文件。
      </p>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          本章剩余部分和后续各章中的命令都要在 chroot 环境中运行。如果您因为一些原因 (如重新启动计算机)
          离开了该环境，必须确认虚拟内核文件系统如<a class="xref" href=
          "kernfs.html#ch-tools-bindmount" title=
          "7.3.2.&nbsp;挂载和填充 /dev">第&nbsp;7.3.2&nbsp;节 “挂载和填充
          /dev”</a>和<a class="xref" href="kernfs.html#ch-tools-kernfsmount"
          title="7.3.3.&nbsp;挂载虚拟内核文件系统">第&nbsp;7.3.3&nbsp;节
          “挂载虚拟内核文件系统”</a>所述挂载好，然后重新进入 chroot 环境，才能继续安装 LFS。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="kernfs.html" title="准备虚拟内核文件系统">上一页</a>
          <p>
            准备虚拟内核文件系统
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="creatingdirs.html" title="创建目录">下一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200915-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
