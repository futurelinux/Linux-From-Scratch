<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      8.77.&nbsp;清理系统
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-20200915-systemd，中文翻译版">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 20200915-systemd，中文翻译版
      </h4>
      <h3>
        第&nbsp;8&nbsp;章&nbsp;安装基本系统软件
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="strippingagain.html" title=
          "再次移除调试符号">上一页</a>
          <p>
            再次移除调试符号
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../chapter09/chapter09.html" title=
          "系统配置">下一页</a>
          <p>
            系统配置
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "第&nbsp;8&nbsp;章&nbsp;安装基本系统软件">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200915-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-system-revisedchroot" name=
        "ch-system-revisedchroot"></a>8.77. 清理系统
      </h1>
      <p>
        最后，清理在执行测试的过程中遗留的一些文件：
      </p>
      <pre class="userinput"><kbd class="command">rm -rf /tmp/*</kbd></pre>
      <p>
        现在需要登出，并使用新的 chroot 命令行重新进入 chroot 环境。从现在起，在退出并重新进入 chroot
        环境时，要使用下面的修改过的 chroot 命令：
      </p>
      <pre class="userinput"><kbd class="command">logout

chroot "$LFS" /usr/bin/env -i          \
    HOME=/root TERM="$TERM"            \
    PS1='(lfs chroot) \u:\w\$ '        \
    PATH=/bin:/usr/bin:/sbin:/usr/sbin \
    /bin/bash --login</kbd></pre>
      <p>
        这里不再使用 <em class="parameter"><code>+h</code></em>
        选项，因为所有之前安装的程序都已经替换成了最终版本，可以进行散列。
      </p>
      <p>
        如果解除了虚拟内核文件系统的挂载，必须通过手动或重启系统的方式重新挂载它们，保证在进入 chroot 时它们已经挂载好。<a class=
        "xref" href="../chapter07/kernfs.html#ch-tools-bindmount" title=
        "7.3.2.&nbsp;挂载和填充 /dev">第&nbsp;7.3.2&nbsp;节 “挂载和填充
        /dev”</a>和<a class="xref" href=
        "../chapter07/kernfs.html#ch-tools-kernfsmount" title=
        "7.3.3.&nbsp;挂载虚拟内核文件系统">第&nbsp;7.3.3&nbsp;节
        “挂载虚拟内核文件系统”</a>已经说明了这一过程。
      </p>
      <p>
        在本章的前几节中，有几个静态库的安装没有被禁止，目的是满足一些软件包的退化测试需要。这些库来自于
        binutils、bzip2、e2fsprogs、flex、libtool 和 zlib。如果您希望的话，可以现在删除它们：
      </p>
      <pre class="userinput"><kbd class=
      "command">rm -f /usr/lib/lib{bfd,opcodes}.a
rm -f /usr/lib/libctf{,-nobfd}.a
rm -f /usr/lib/libbz2.a
rm -f /usr/lib/lib{com_err,e2p,ext2fs,ss}.a
rm -f /usr/lib/libltdl.a
rm -f /usr/lib/libfl.a
rm -f /usr/lib/libz.a</kbd></pre>
      <p>
        在 /usr/lib 和 /usr/libexec 目录中还有一些扩展名为 .la 的文件。它们是 "libtool 档案"
        文件。正如我们已经讨论过的，它们在链接到共享库，特别是使用 autotools
        以外的构建系统时，是不必要，甚至有害的。执行以下命令删除它们：
      </p>
      <pre class="userinput"><kbd class=
      "command">find /usr/lib /usr/libexec -name \*.la -delete</kbd></pre>
      <p>
        如果希望了解更多关于 libtool 档案文件的信息，参阅 <a class="ulink" href=
        "http://www.linuxfromscratch.org/blfs/view/svn//introduction/la-files.html">
        BLFS 章节 "About Libtool Archive (.la) files"</a>。
      </p>
      <p>
        在<a class="xref" href="../chapter06/chapter06.html" title=
        "第&nbsp;6&nbsp;章&nbsp;交叉编译临时工具">第 6 章</a>和<a class="xref" href=
        "../chapter07/chapter07.html" title=
        "第&nbsp;7&nbsp;章&nbsp;进入 Chroot 并构建其他临时工具">第 7
        章</a>中构建的编译器仍然有一部分安装在系统上，它现在已经没有存在的意义了。执行命令删除它：
      </p>
      <pre class="userinput"><kbd class=
      "command">find /usr -depth -name $(uname -m)-lfs-linux-gnu\* | xargs rm -rf</kbd></pre>
      <p>
        <code class="filename">/tools</code> 也可以被删除，从而获得更多可用空间：
      </p>
      <pre class="userinput"><kbd class="command">rm -rf /tools</kbd></pre>
      <p>
        最后，移除上一章开始时创建的临时 'tester' 用户账户。
      </p>
      <pre class="userinput"><kbd class=
      "command">userdel -r tester</kbd></pre>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="strippingagain.html" title=
          "再次移除调试符号">上一页</a>
          <p>
            再次移除调试符号
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../chapter09/chapter09.html" title=
          "系统配置">下一页</a>
          <p>
            系统配置
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "第&nbsp;8&nbsp;章&nbsp;安装基本系统软件">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 20200915-systemd，中文翻译版">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
